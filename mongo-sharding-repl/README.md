# pymongo-api

## Как запустить

Запускаем MongoDB кластер с шардированием и приложение.

### Шаги запуска

1. Запустите весь стек:
   ```bash
   docker compose up -d --build
   ```

2. Инициализируйте MongoDB и настройте шардирование:
   ```bash
   ./scripts/mongo-init.sh
   ```

### Остановка и удаление контейнеров

Чтобы остановить и удалить контейнеры:
```bash
docker compose down -v
```
---

## Как проверить

### Если вы запускаете проект на локальной машине

Откройте в браузере http://localhost:8080

### Если вы запускаете проект на предоставленной виртуальной машине

Узнать белый ip виртуальной машины

```shell
curl --silent http://ifconfig.me
```

Откройте в браузере http://<ip виртуальной машины>:8080

## Доступные эндпоинты

Список доступных эндпоинтов, swagger http://<ip виртуальной машины>:8080/docs

## Что входит в проект

## Что входит в проект

### Архитектура

Проект включает следующие компоненты:

- **Конфигурационный сервер (`config_srv`)**: Хранит метаданные о шардах. Порт: `27017`.
- **Шарды**:
  - **`shard_1`**: Основной реплицированный шард (порты: `27018`, `27019`, `27020`).
  - **`shard_2`**: Второй реплицированный шард (порты: `27021`, `27022`, `27023`).
- **Маршрутизатор (`mongos_router`)**: Перенаправляет запросы на подходящие шарды. Порт: `27024`.
- **Python API (`pymongo_api`)**: REST API для взаимодействия с MongoDB. Порт: `8080`.

---

## Сеть

Все службы находятся в одной сети Docker `app-network` с подсетью `173.17.0.0/16`.

IP-адреса контейнеров:

- `config_srv`: `173.17.0.10`
- `shard_1` (реплики):
  - `shard_1_1`: `173.17.0.9`
  - `shard_1_2`: `173.17.0.8`
  - `shard_1_3`: `173.17.0.7`
- `shard_2` (реплики):
  - `shard_2_1`: `173.17.0.6`
  - `shard_2_2`: `173.17.0.5`
  - `shard_2_3`: `173.17.0.4`
- `mongos_router`: `173.17.0.3`
- `pymongo_api`: `173.17.0.2`

---