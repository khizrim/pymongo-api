# pymongo-api

## Как запустить

Запускаем MongoDB кластер с шардированием и приложение.

### Шаги запуска

1. Запустите весь стек:
   ```bash
   docker compose up -d --build
   ```

2. Инициализируйте MongoDB и настройте шардирование:
   ```bash
   ./scripts/mongo-init.sh
   ```

### Остановка и удаление контейнеров

Выполните команду

---

## Как проверить

### Если вы запускаете проект на локальной машине

Откройте в браузере http://localhost:8080

### Если вы запускаете проект на предоставленной виртуальной машине

Узнать белый ip виртуальной машины

```shell
curl --silent http://ifconfig.me
```

Откройте в браузере http://<ip виртуальной машины>:8080

## Доступные эндпоинты

Список доступных эндпоинтов, swagger http://<ip виртуальной машины>:8080/docs

## Что входит в проект

### Архитектура

Проект включает шардированный кластер MongoDB, построенный на нескольких Docker-контейнерах:

- **Конфигурационный сервер (`config_srv`)**
  Хранит метаданные о шардах.
  Порт: `27017`

- **Шарды (`shard_1` и `shard_2`)**
  Основные узлы хранения данных:
  - `shard_1`: порт `27018`
  - `shard_2`: порт `27019`

- **Маршрутизатор Mongo (`mongos_router`)**
  Перенаправляет запросы к подходящим шардам.
  Порт: `27020`

- **Python API (`pymongo_api`)**
  REST API для взаимодействия с базой данных.
  Порт: `8080`

---

## Сеть

Все службы находятся в одной сети Docker `app-network` с подсетью `173.17.0.0/16`.
IP-адреса контейнеров:
- `config_srv`: `173.17.0.10`
- `shard_1`: `173.17.0.9`
- `shard_2`: `173.17.0.8`
- `mongos_router`: `173.17.0.7`
- `pymongo_api`: `173.17.0.6`

---